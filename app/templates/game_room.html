{% extends "base_arena.html" %}

{% block title %}{{ title }}{% endblock %}

{% set player_status = setup['player_status'] %}
{% set player1 = player_status.get('player1') %}
{% set player2 = player_status.get('player2') %}
{% set player1_name = player1['player_name'] if player1 and player1['player_name'] else 'Player 1' %}
{% set player2_name = player2['player_name'] if player2 and player2['player_name'] else 'Player 2' %}
{% block content %}
<div id="game-setup-root"
    class="py-12 px-4"
    data-game-room-config='{{ {
        "gameId": game_id,
        "playerRole": player_role,
        "setupApiUrl": setup_api_url,
        "submitApiUrl": submit_api_url,
        "gameInterfaceUrl": game_interface_url,
        "initialStatus": setup,
        "shareLinks": share_links
    } | tojson | e }}'>
    <noscript>
        <div class="max-w-2xl mx-auto bg-red-950/60 border border-red-500/40 rounded-xl p-6 text-sm text-red-50">
            JavaScript is required to prepare the duel room. Please enable it and reload this page.
        </div>
    </noscript>
</div>
{% endblock %}

{% block extra_js %}
<script type="module">
    import GameRoomSetup, { mount } from '/static/js/ui/components/GameRoomSetup.esm.js';
    const root = document.getElementById('game-setup-root');
    if (!root) throw new Error('game-setup-root not found');

    const config = (() => {
        if (window.gameRoomConfig) return window.gameRoomConfig;
        try {
            const parsed = JSON.parse(root.dataset?.gameRoomConfig || '{}');
            window.gameRoomConfig = parsed;
            return parsed;
        } catch (e) {
            return {};
        }
    })();

    if (!config?.gameId) {
        root.innerHTML = '<div class="max-w-2xl mx-auto bg-red-950/60 border border-red-500/40 rounded-xl p-6 text-sm text-red-50">Unable to load duel room.</div>';
    } else {
        mount(GameRoomSetup, { target: root, props: { config } });
    }
</script>
{% endblock %}
